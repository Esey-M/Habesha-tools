// Save quiz
saveBtn.addEventListener('click', async function() {
    const quizData = {
        title: titleInput.value,
        description: descriptionInput.value,
        questions: Array.from(questionsContainer.children).map(questionEl => ({
            text: questionEl.querySelector('.question-text').value,
            options: Array.from(questionEl.querySelectorAll('.option-input')).map(opt => ({
                text: opt.value,
                isCorrect: opt.closest('.option').querySelector('.is-correct').checked
            }))
        }))
    };

    try {
        const response = await fetch('/quiz/new', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(quizData)
        });

        if (!response.ok) {
            throw new Error('Failed to save quiz');
        }

        const data = await response.json();
        alert('Quiz saved successfully!');
        window.location.href = `/quiz/${data.id}`;
    } catch (error) {
        alert('Error saving quiz: ' + error.message);
    }
});

// Load quiz for taking
async function loadQuiz(quizId) {
    try {
        const response = await fetch(`/quiz/${quizId}`);
        if (!response.ok) {
            throw new Error('Failed to load quiz');
        }

        const quiz = await response.json();
        document.getElementById('quiz-title').textContent = quiz.title;
        document.getElementById('quiz-description').textContent = quiz.description;

        const questionsContainer = document.getElementById('questions');
        questionsContainer.innerHTML = '';

        quiz.questions.forEach((question, index) => {
            const questionEl = document.createElement('div');
            questionEl.className = 'card mb-3';
            questionEl.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title">Question ${index + 1}</h5>
                    <p class="card-text">${question.text}</p>
                    <div class="options">
                        ${question.options.map((option, optIndex) => `
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="q${index}" value="${optIndex}" id="q${index}o${optIndex}">
                                <label class="form-check-label" for="q${index}o${optIndex}">
                                    ${option.text}
                                </label>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            questionsContainer.appendChild(questionEl);
        });
    } catch (error) {
        alert('Error loading quiz: ' + error.message);
    }
}

// Submit quiz
submitBtn.addEventListener('click', async function() {
    const answers = Array.from(document.querySelectorAll('input[type="radio"]:checked')).map(input => ({
        questionIndex: parseInt(input.name.substring(1)),
        answerIndex: parseInt(input.value)
    }));

    try {
        const quizId = window.location.pathname.split('/').pop();
        const response = await fetch(`/quiz/${quizId}/submit`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                answers: answers
            })
        });

        if (!response.ok) {
            throw new Error('Failed to submit quiz');
        }

        const result = await response.json();
        window.location.href = `/quiz/result/${result.id}`;
    } catch (error) {
        alert('Error submitting quiz: ' + error.message);
    }
}); 